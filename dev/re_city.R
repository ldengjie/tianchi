library("TSclust")
library("mclust")
od1<-read.csv("redeem_by_type_sum_p1_v4.csv")
od2<-read.csv("redeem_by_type_sum_p2_v4.csv")
od<-od1+od2
fitbeg<-275;#20140401
fitend<-427;#20140831
prebeg<-fitend+1;
preend<-457;#20140930
fd<-od[fitbeg:fitend,]

report_date      <-ts(fd$report_date,fre=7)
total_redeem_amt <-ts(log(fd$total_redeem_amt ),fre=7)
tftobal_amt      <-ts(log(fd$tftobal_amt      ),fre=7)
category1        <-ts(log(fd$category1        ),fre=7)
category2        <-ts(log(fd$category2        ),fre=7)
category3        <-ts(log(fd$category3        ),fre=7)
category4        <-ts(log(fd$category4        ),fre=7)
izfb11                <-ts(log(fd$zfb11),fre=7)
izfb12                <-ts(log(fd$zfb12),fre=7)
izfb13                <-ts(log(fd$zfb13),fre=7)
izfb14                <-ts(log(fd$zfb14),fre=7)
izfb15                <-ts(log(fd$zfb15),fre=7)
izfb16                <-ts(log(fd$zfb16),fre=7)
izfb17                <-ts(log(fd$zfb17),fre=7)
izfb21                <-ts(log(fd$zfb21),fre=7)
izfb22                <-ts(log(fd$zfb22),fre=7)
izfb23                <-ts(log(fd$zfb23),fre=7)
izfb24                <-ts(log(fd$zfb24),fre=7)
izfb25                <-ts(log(fd$zfb25),fre=7)
izfb26                <-ts(log(fd$zfb26),fre=7)
izfb27                <-ts(log(fd$zfb27),fre=7)
icard11               <-ts(log(fd$card11),fre=7)
icard12               <-ts(log(fd$card12),fre=7)
icard13               <-ts(log(fd$card13),fre=7)
icard14               <-ts(log(fd$card14),fre=7)
icard15               <-ts(log(fd$card15),fre=7)
icard16               <-ts(log(fd$card16),fre=7)
icard17               <-ts(log(fd$card17),fre=7)
icard21               <-ts(log(fd$card21),fre=7)
icard22               <-ts(log(fd$card22),fre=7)
icard23               <-ts(log(fd$card23),fre=7)
icard24               <-ts(log(fd$card24),fre=7)
icard25               <-ts(log(fd$card25),fre=7)
icard26               <-ts(log(fd$card26),fre=7)
icard27               <-ts(log(fd$card27),fre=7)
icard31               <-ts(log(fd$card31),fre=7)
icard32               <-ts(log(fd$card32),fre=7)
icard33               <-ts(log(fd$card33),fre=7)
icard34               <-ts(log(fd$card34),fre=7)
icard35               <-ts(log(fd$card35),fre=7)
icard36               <-ts(log(fd$card36),fre=7)
icard37               <-ts(log(fd$card37),fre=7)

zfb1<-as.matrix(scale(cbind(fd$zfb11,fd$zfb12,fd$zfb13,fd$zfb14,fd$zfb15,fd$zfb16,fd$zfb17)))
zfb2<-as.matrix(scale(cbind(fd$zfb21,fd$zfb22,fd$zfb23,fd$zfb24,fd$zfb25,fd$zfb26,fd$zfb27)))
card1<-as.matrix(scale(cbind(fd$card11,fd$card12,fd$card13,fd$card14,fd$card15,fd$card16,fd$card17)))
card2<-as.matrix(scale(cbind(fd$card21,fd$card22,fd$card23,fd$card24,fd$card25,fd$card26,fd$card27)))
card3<-as.matrix(scale(cbind(fd$card31,fd$card32,fd$card33,fd$card34,fd$card35,fd$card36,fd$card37)))

cat("#EM zfb1 \n")
fm<-Mclust(t(zfb1))
print(fm$class)

cat("#EM zfb2 \n")
fm<-Mclust(t(zfb2))
print(fm$class)

cat("#EM card1 \n")
fm<-Mclust(t(card1))
print(fm$class)

cat("#EM card2 \n")
fm<-Mclust(t(card2))
print(fm$class)

cat("#EM card3 \n")
fm<-Mclust(t(card3))
print(fm$class)
